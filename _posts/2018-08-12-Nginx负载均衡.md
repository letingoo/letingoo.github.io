---
layout: post
title: Nginx负载均衡
---


Nginx内置的负载均衡策略有三种：轮询、加权轮询和ipHash。


	upstream backend {
		server 1;
		server 2;
	}

	
轮询是最简单的，每个服务器轮着分发。而Nginx对于加权轮询采取的是平滑的轮询方式。

算法大概如下：每个后端有三个weight：
1. 设定的weight。  

2. effective_weight，初始值为设定的weight。  

3. current_weight，初始值为0。

对于每个请求，遍历所有的节点，对每一个节点都执行：current_weight += effective_weight。同时累加所有的effective_weight,设定为total。

选择最大current_weight的节点，再把该节点的current_weight减去total。

这样会产生一个比较平滑的序列。