---
layout: post
title: Hystrix简述
---


Hystrix的步骤：

1. 构造HystrixCommand对象

2. 执行命令

3. 判断是否用缓存相应请求，默认不开启

4. 判断是否断路器打开，如果打开直接fallback

5. 判断线程池/信号量是否已满，如果已满则直接fallback

6. 执行业务流程，如果超时或者异常则fallback

7. 统计熔断器监控指标

8. 执行fallback逻辑

9. 返回结果




Hystrix熔断器的状态：OPEN，CLOSE，HALF_OPEN。

状态之间的转换：正常情况下是CLOSE状态，当失败率达到阈值则进入OPEN状态，经过sleepWindow时间后进入HALF_OPEN状态，
会放开流量尝试，如果成功进入CLOSE状态，否则进入OPEN状态。


比较重要的参数：

1. circuitBreaker.errorThresholdPercentage: 错误率，默认是50%，如果窗口时间内有100个请求，错误率超过这一指标则熔断器打开

2. circuitBreaker.requestVolumeThreshold: 窗口时间内至少要达到这个值才计算errorThresholdPercentage。默认值是20。如果一段时间内有19个请求全部失败或超时则熔断器也不会打开

3. circuitBreaker.sleepWindowInMilllseconds:
half_open的持续时间，默认值是5000，当熔断器开启5000ms之后，会尝试放一些请求执行，如果成功则关闭熔断器

4. metrics.rollingStats.timeInMilliseconds:
滚动窗口的时序时间，对于断路器的使用和发布hystrix保持指标的时间。


